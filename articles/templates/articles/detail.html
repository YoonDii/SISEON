{% extends 'base.html' %}
{% load django_bootstrap5%}
{% load static %}

{% block content %}
<div class= "container">
조회수:{{ articles.hits }}
  {% if articles.unname %}
  익명{{articles.user.pk}}
  {{articles.title}}
  {{articles.category}}
  <!-- 작성일자 -->
    {% if not articles.updated_at %}
    <p class="date">{{articles.create_at}}</p>
    <!-- 글이 수정될 경우 (수정됨)이 붙음 -->
    {% else %}
    <p class="edited">{{articles.create_at}}(수정됨)</p>
      {% endif %}
  <div id="content"><textarea>{{ articles.content }}</textarea></div>
  
  {% else %}
  
    <a href={% url 'accounts:detail' articles.user.pk %}>{{articles.user.nickname}}</a>
    {{articles.title}}
    {{articles.category}}
    <!-- 작성일자 -->
      {% if not articles.check %}
      <p class="date">{{articles.create_at}}</p>
      <!-- 글이 수정될 경우 (수정됨)이 붙음 -->
      {% else %}
      <p class="edited">{{articles.create_at}}(수정됨)</p>
      {% endif %}
    <div id="content"><textarea>{{ articles.content }}</textarea></div>
  
  {% endif %}

  {% if photos %}
    {% for photo in photos %}
      <img src="{{ photo.image.url }}">
    {% endfor %}
  {% endif %}
  <!-- 수정 / 삭제 -->
  {% if request.user == articles.user %}
    <div class="d-flex justify-content-end">
      <a href="{% url 'articles:update' articles.pk %}" class="btn btn-primary">수정</a>
      <form class="m-0" action="{% url 'articles:delete' articles.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="삭제">
      </form>
    </div>
  {% endif %}


  <!-- 좋아요 -->
  {% if request.user.is_authenticated %}
    <div class="heart">
      {% if request.user not in articles.like_users.all %}
        <i data-like-id="{{ articles.pk }}" id="like-btn" class="bi bi-heart article-heart"></i>
      {% else %}
        <i data-like-id="{{ articles.pk }}" id="like-btn" class="bi bi-heart-fill article-heart-fill"></i>
      {% endif %}
      <p id="likes">{{ articles.like_users.count }}</p>
    </div>
  {% endif %}


  <!-- 댓글 -->
  <section class="comment-box">
    {% if request.user.is_authenticated %}
      <form id="comment-form" data-articles-id="{{ articles.pk }}" action="{% url 'articles:comment_create' articles.pk %}" method="POST">
        {% csrf_token %}
        {% bootstrap_form comment_form %}
        <input class="btn btn-success" type="submit" value="제출">
      </form>
    {% endif %}
    <div id="comments">
      {% for comment in comments %}
        <div class="comment">
          {% if not comment.unname %}
            <h4>{{comment.user}}
              -
              {{ comment.content }}</h4>
          {% else %}
            <h4>익명{{comment.user.pk}}
              -
              {{ comment.content }}</h4>
          {% endif %}
          <div>
            {% if request.user.pk == comment.user.pk %}
              <div>
                <div id="form-comment-update-{{ comment.pk }}" style="display:none;">
                  <input id="input-{{ comment.pk }}" type="text" value="{{ comment.content }}">
                  <button onclick="ok_function(this)" id="okBtn-{{ comment.pk }}" data-articlesup-id="{{ articles.pk }}" data-commentup-id="{{ comment.pk }}">확인</button>
                </div>
                <button onclick="update_comment(this)" id="comment-update-{{ comment.pk }}" data-articlesup-id="{{ articles.pk }}" data-commentup-id="{{ comment.pk }}">수정</button>
                <button onclick="delete_comment(this)" id="comment-delete-{{ comment.pk }}" data-articlesdel-id="{{ articles.pk }}" data-commentdel-id="{{ comment.pk }}">삭제</button>
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </section>
</div>
{% endblock %}


{% block js %}
<script src="{% static 'articles/js/mde/js/jquery.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/lib/marked.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/editormd.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/lib/prettify.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/lib/raphael.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/lib/underscore.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/lib/sequence-diagram.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/lib/flowchart.min.js' %}"></script>
<script src="{% static 'articles/js/mde/js/lib/jquery.flowchart.min.js' %}"></script>
<script>
  $(function () {
      // js markdown
      editormd.markdownToHTML("content", {
          emoji           : true,
          taskList        : true,
          tex             : true,  
          flowChart       : true,  
          sequenceDiagram : true,
      });
      console.log(obj)
      $(".reference-link").each(function (i,obj) {
        console.log(obj)
      })
  })
</script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="{% static 'articles/js/detail.js' %}"></script>

{% endblock js %}